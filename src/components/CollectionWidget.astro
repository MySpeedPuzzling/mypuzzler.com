---
import WidgetWrapper from "./WidgetWrapper.astro";
import { collection } from "../data/mock-data";

const tabs = [
  { key: "sell", label: "Sell/Swap" },
  { key: "wishlist", label: "Wishlist" },
  { key: "collection", label: "My Collection" },
] as const;
---

<WidgetWrapper title="Collection" moreLink="https://myspeedpuzzling.com/player/simona-mikesova/collection" moreText="Browse on MySpeedPuzzling →">
  <!-- Tabs -->
  <div class="flex gap-1 bg-slate-100 rounded-lg p-1 mb-4">
    {tabs.map((tab, i) => (
      <button
        class="tab-btn flex-1 py-1.5 text-xs font-medium rounded-md"
        data-tab-group="collection"
        data-tab={tab.key}
        data-active={i === 0 ? "true" : "false"}
      >
        {tab.label}
      </button>
    ))}
  </div>

  <!-- Tab panels -->
  {tabs.map((tab, i) => (
    <div
      class:list={["space-y-2", { hidden: i !== 0 }]}
      data-panel-group="collection"
      data-panel={tab.key}
    >
      {collection[tab.key].map((item) => (
        <div class="flex items-center gap-3 p-2 bg-slate-50 rounded-lg">
          <!-- Thumbnail -->
          <div class={`shrink-0 w-12 h-12 rounded-lg bg-gradient-to-br ${item.gradient}`}></div>
          <!-- Info -->
          <div class="flex-1 min-w-0">
            <div class="text-sm font-medium text-slate-700 truncate">{item.puzzleName}</div>
            <div class="text-xs text-slate-400">{item.brand} · {item.pieces}pc</div>
          </div>
          <!-- Badge -->
          <div class="shrink-0">
            {tab.key === "sell" && (
              item.swapOnly ? (
                <span class="text-xs font-medium bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full">Swap</span>
              ) : (
                <span class="text-xs font-medium bg-emerald-100 text-emerald-600 px-2 py-0.5 rounded-full">{item.price}</span>
              )
            )}
            {tab.key === "wishlist" && (
              <svg class="w-5 h-5 text-coral-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" />
              </svg>
            )}
            {tab.key === "collection" && (
              <svg class="w-5 h-5 text-emerald" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            )}
          </div>
        </div>
      ))}
    </div>
  ))}
</WidgetWrapper>

<script>
  function initTabs(groupName: string) {
    const buttons = document.querySelectorAll<HTMLButtonElement>(`[data-tab-group="${groupName}"]`);
    const panels = document.querySelectorAll<HTMLElement>(`[data-panel-group="${groupName}"]`);

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab!;

        buttons.forEach(b => b.dataset.active = "false");
        btn.dataset.active = "true";

        panels.forEach(p => {
          p.classList.toggle("hidden", p.dataset.panel !== tab);
        });
      });
    });
  }

  initTabs("collection");
</script>
